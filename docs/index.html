<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>An Introduction to Modern Authentication and Authorization</title>

		<meta name="description" content="Theory and hands-on examples to do web based Authentication and Authorization">
		<meta name="author" content="Lars Kåre Skjørestad">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/moon.css" id="theme">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/monokai.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5sßhiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">

				<!-- Front page -->
				<section style="text-align: left;">
					<h1>Modern A&A</h1>
					<h4>Authentication (OpenID) and Authorization (oAuth2)</h3>
					<small>An introduction to a vast and complex topic</small>
					<p>
						<small><a href="https://loop.equinor.com" target="_blank">Equinor</a></Equinor> <font style="color:red;">#AppSec</font> community</a></small>
					</p>
				</section>

				<!-- Objectives part-->
				<section>
					<section>
						<h1>Objectives</h1>
					</section>

					<section>
						<h3>Workshop objectives </h3>
						<blockquote>Enable participants to continue exploring a&a with a bit more confidence</blockquote>
						<ul>
							<li>a introduction to basics modern web A&A</li>
							<li>specs, protocols, grants & flows</li>
							<li>hands-on with a few A&A scenarios </li>
							<li>insight into threat modelling and good security practices</li>
						</ul>
					</section>

				</section>
				
<!-- Outlines part-->
				<section>
					<section>
						<h1>Outline</h1>
					</section>
					<section style="text-align: left;">
						<h3>Workshop outline</h3>
						<ul>
							<li>Pre-requisites, Practicalities</li>
							<li>The basics of A&A </li>
							<li>Exercises (11)</li>
							<li>Prepare web app, add authentication, get access token, use access token, using frameworks & libraries, accessing 3rd party api, refresh tokens, single page web app (SPA), protecting web api's & DevOps (Radix)
							<li>Security</li>
							<li>Hack your own project</li>
						</ul>
					</section>
				</section>

<!-- Disclaimer part-->
				<section>
					<h1>Disclaimer</h1>
					<p>The more I learn about the topic the more I realize how complex it is. I am not an expert - in fact I am not even sure what an expert in this field is. I want to share what I think I know. I assume that quite a few of you know some of these topics a lot better than me. We would really appreciate your insight! Sharing is caring!</p>
				</section>
				
<!-- Pre-requisites part-->
				<section>
					<section>
						<h1>Pre-Requisites</h1>
					</section>
					<section>
						<h2>Roles</h2>
						<ul>
							<li>Valid Equinor Software Developer On-Boarding</li>
							<li>Valid role <strong>Application Developer (Azure Active Directory)</strong> - apply in AccessIT</li>
							<li>Valid role <strong>Radix Playground User (OMNIA RADIX)</strong> - apply in AccessIT</li>
						</ul>					
					</section>
					<section>
							<h2>Skills</h2>
							<p>Helpful knowledge:
								<ul>
									<li><a href="https://httpwg.org/specs/" target="_blank">HTTP</a></li>
									<li>JavaScript/Node.js</li>
									<li>Docker</li>
								</ul>
							</p>					
					</section>
					<section>
							<h2>Software</h2>
							<small>Installed and verified to work software</small></br>
								<ul>
									<li><a href="https://nodejs.org/en/" target"_blank">Node.js</a></li>
									<li>Development IDE (<a target="_blank" href="https://code.visualstudio.com"> like VS Code</a>)</li>
									<li>Git, account in github.com</li>
									<li>(<a href="https://www.getpostman.com/downloads/" target="_blank">Postman</a>)</li>
									<li>(Docker)</li>
								</ul>
					</section>	
				</section>

<!-- The practicalities & useful links part -->
				<section>
					<section>
						<h1>Practicalities</h1>
						<h3>#slack channel</h3>
					</section>
					<section>
							<h1>Useful links</h1>
							<small>
								<ul>
									<li><a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/" target="_blank">Microsoft Identity Platform</a></li>
									<li><a href="https://oauth.net/2/" target="_blank">oAuth2.net</a></li>
									<li><a href="https://tools.ietf.org/html/rfc6749" target="_blank">The OAuth Authorization Framework (rfc 6749)</a></li>
									<li><a href="https://openid.net/connect/" target="_blank">OpenID Connect</a></li>
								</ul>
							</small>
						</section>
		
				</section>

<!-- The basic of A&A -->
				<section>
					<section>
						<h1>The basics of A&A</h1>
					</section>
					<section>
						<h3>Authentication vs. Authorization</h3>
						<p><span style="color:red">Authentication</span> =</br>is the mechanism to verify the identity of a user</p>
						<p><span style="color:red">Authorization</span> = </br>is the mechanism to verify access to a resource</p>
					</section>
					<section>
						<h3>oAuth2</h3>
						<blockquote style="font-size: 80%">
						The OAuth 2.0 authorization framework enables a third-party application to obtain limited access to an HTTP service, either on behalf of a resource owner by orchestrating an approval interaction between the resource owner and the HTTP service, or by allowing the third-party application to obtain access on its own behalf. </blockquote>
						<small>oAuth2 is a <strong>delegation protocol</strong>, a means of letting someone who controls a resource to let application access the resource ont their behalf (without impersonating).</small>
					</section>
					<section style="font-size: 75%">
						<h3>Roles</h3>
						<p><div style="color:yellow">resource owner</div>
						An entity capable of granting access to a protected resource.
						When the resource owner is a person, it is referred to as an
						end-user.
						</p>
						<p><div style="color:yellow">resource server</div>
						The server hosting the protected resources, capable of accepting
						and responding to protected resource requests using access tokens.
						</p>
						<p><div style="color:yellow">client</div>
						An application making protected resource requests on behalf of the
						resource owner and with its authorization.  The term "client" does
						not imply any particular implementation characteristics (e.g.,
						whether the application executes on a server, a desktop, or other
						devices).
						</p>
						<p><div style="color:yellow"> authorization server</div>				
						The server issuing access tokens to the client after successfully
						authenticating the resource owner and obtaining authorization.
						</p>
					</section>
					<section>
						<h4>Protocol flow</h4>
						<pre>
+--------+                               +---------------+
|        |--(A)- Authorization Request ->|   Resource    |
|        |                               |     Owner     |
|        |<-(B)-- Authorization Grant ---|               |
|        |                               +---------------+
|        |
|        |                               +---------------+
|        |--(C)-- Authorization Grant -->| Authorization |
| Client |                               |     Server    |
|        |<-(D)----- Access Token -------|               |
|        |                               +---------------+
|        |
|        |                               +---------------+
|        |--(E)----- Access Token ------>|    Resource   |
|        |                               |     Server    |
|        |<-(F)--- Protected Resource ---|               |
+--------+                               +---------------+

						</pre>
					</section>
					<section>
						<h4 style="text-align: left;">High level oAuth flow</h4>
						<pre style="font-size: 40%; text-align: left;">
+-- <span style="color:red">Resource</span> --+ +-- <span style="color: yellow;">Client</span> -- + +- <span style="color:yellowgreen">Authorization</span> -+ +--<span style="color:violet"> Protected</span> --+
+    Owner     + +             + +     Server      + +   Resource    +
+--------------+ +-------------+ +-----------------+ +---------------+
     -                   -                -                     -
     |  <span style="color:yellow">(A)Client request</span>|                |                     |
     |      <span style="color:yellow">Authorization</span>|                |                     |
     |<------------------|                |                     |
     |- - - - - - - - - - - - - - - - - ->|                     |
     |                   |                |                     |
     |<span style="color:red">(B) Resource Owner</span> |                |                     |
     |<span style="color:red">Grants authorization</span>                |                     |
     |----------------------------------->|                     |
     |                   |<- - - - - - - -|                     |
     |                   |                |                     |
     |                   |<span style="color:yellow">(C) Client send</span> |                     |
     |                   |  <span style="color:yellow">Authorization</span> |                     |
     |                   |          <span style="color:yellow">grant</span> |                     | 
     |                   |--------------->|                     |
     |                   |                |                     |
     |                   | <span style="color:yellowgreen">(D)Autorization</span>|                     |
     |                   |    <span style="color:yellowgreen">server sends</span>|                     |
     |                   |    <span style="color:yellowgreen">access token</span>|                     |
     |                   |<---------------|                     |
     |                   |                |                     |
     |                   |<span style="color:yellow">(E)Client sends</span> |                     |
     |                   |<span style="color:yellow">Access Token</span>    |                     |
     |                   |------------------------------------->|
     |                   |                |                     |
     |                   |                |<span style="color:violet">(F)Protected resource</span>|
     |                   |                |       <span style="color:violet">sends resource</span>|
     |                   |<-------------------------------------|
     |                   |                |                     |
     -                   -                -                     -                                   
						</pre>
					</section>

					<section>
						<h3>What oAuth is and is not</h3>
						<ul>
							<li>Is not Defined outside HTTP</li>
							<li>Is "requiring" TLS</li>
							<li>Is not an authentication protocol</li>
							<li>Is not processing authorization</li>
							<li>Is not defining user-to-user delegation</li>
							<li>Is not defining a token format</li>
							<li>Is not defining crypto methods</li>
							<li>Is not a single protocol - </br>it supports multiple use cases</li>
						</ul>
					</section>

					<section>
						<h2>Tokens</h2>
						<ul>
							<li><span style="color:red">Access token</span></br><span style="font-size: 80%">Access tokens are credentials used to access protected resources.  An access token is a string representing an authorization issued to the	client.  The string is usually opaque to the client.  Tokens represent specific scopes and durations of access, granted by the resource owner, and enforced by the resource server and authorization server.</span>
							 </li>
						</ul>						
					</section>

					<section>
							<h2>Tokens</h2>
							<ul>
								<li><span style="color:red">Refresh token</span></br><span style="font-size: 80%">Refresh tokens are credentials used to obtain access tokens.  Refresh tokens are issued to the client by the authorization server and are used to obtain a new access token when the current access token becomes invalid or expires, or to obtain additional access tokens with identical or narrower scope (access tokens may have a shorter lifetime and fewer permissions than authorized by the resource	owner).  Issuing a refresh token is optional at the discretion of the authorization server.  If the authorization server issues a refresh token, it is included when issuing an access token.</span>
								 </li>
							</ul>						
					</section>

					<section>
						<h3>Azure AD (AAD) issues JWT tokens</h3>
						<small><a href="https://tools.ietf.org/html/rfc7519" target="_blank">JSON Web Token (JWT)(RFC7519)</a></small></br>
						<div style="font-size:40%; text-align: center;">eyJ0eXAiOiJKV1QiLA0KICJhbGciOiJIUzI1NiJ9<span style="color:red">.</span></br>eyJpc3MiOiJqb2UiLA0KICJleHAiOjEzMDA4MTkzODAsDQogImh0dHA6Ly9leGFtcGxlLmNvbS9pc19yb290Ijp0cnVlfQ<span style="color:red">.</span></br>dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk</div>
						<p></p>
						<pre><code class="hljs">
{
  "typ": "JWT",
  "alg": "HS256"
}.
{
  "iss": "joe",
  "exp": 1300819380,
}.
[Signature]
						</code> 
						</pre>	
						<small>Header, Payload with claims and Signature -  based64 encoded</small>

					</section>
	

					<section>
						<h3>Clients</h3>
						<ul>
							<li>Clients are either confidential or public
								<ul>
									<li><span style="color:red">Confidential:</span> Clients capable of maintaining the confidentiality of their credentials. (Web apps)</li>
									<li><span style="color:red">Public:</span> Clients incapable of maintaining the confidentiality of their credentials (SPA, Native) </li>
								</ul>
							</li>
							<li>Clients provide a redirection URI</li>
						</ul>
					</section>
				
					<section>
						<h3>Protocol Endpoints</h3>
						<ul>
							<li><span style="color:red">Authorization endpoint:</span> used by client to get authorization from resource owner </li>
							<li><span style="color:red">Token endpoint:</span> used by client to exchange authorization grant for an access token</li>
							<li><span style="color:red">Redirection endpoint:</span> used by authorization server to return response containing creds to client</li>
						</ul>
					</section>
					
					<section>
						<h3>Front-channel vs. back-channel</h3>
					</section>

					<section>
							<h3>Obtaining authorization - the oauth Dance</h3>
							<blockquote> To request an access token, the client obtains authorization from the resource owner.  The authorization is expressed in the form of an authorization grant, which the client uses to request the access token.  OAuth defines four grant types: <span style="color:red">authorization code, implicit, resource owner password credentials</span>, and <span style="color:red">client credentials</span>.  It also provides an extension mechanism for defining additional grant types.</blockquote>
					</section>
						
					<section>
						<h3> Authorization Code Grant</h3>
					</section>

				

					<section>
						<h1>OpenID Connect</h1>
					</section>


					<section>
						<h1>Please note ...</h1>
						<ul>
							<li>Use Azue AD v2 endpoints whenever possible</li>
						</ul>
					</section>


				</section>

			


				<section>
					<section>
						<h1>Exercise - 1</h1>
						<h2>Raw http flows</h2>
					</section>	

					<section>Useful tools
						<p>Modern web browser</p>
						<p>Postman</p>

					</section>
				</section>

				<section>
					<section>
						<h1>Exercise 2</h1>
						<h3>Prepare a web application</h3>
					</section>

				</section>
				
				<section>
						<section>
							<h1>Exercise 3</h1>
							<h3>Add authentication</h3>
							<small>OAuth2, OpenID, Auth Code Grant Flow</small>
							<p>Get code</p>
						</section>
	
					</section>
					
				
					<section>
							<section>
								<h1>Exercise 4</h1>
								<h3>Get access token</h3>
								<p>Show token information</p>
							</section>
		
					</section>
					
					<section>
							<section>
								<h1>Exercise 5</h1>
								<h3>Scope</h3>
								<small>And get stuff from the MS Graph</small>
								<small>Consent, Graph explorer, tokens - security, state - session</small>
								<small>A fragile solution</small>
							</section>

					</section>
						
					<section>
							<section>
								<h1>Exercise 6</h1>
								<h3>Use frameworks</h3>
								<small>MSAL</small>
								</is><small>Common problems that must be solved in all eco systems</small>
								</br><small>A bit more robust</small>
							</section>

					</section>

					<section>
							<section>
								<h1>Exercise 7</h1>
								<h3>Authorization</h3>
								<h4>Accessing a 3rd party api</h4>
								<small>Only people with EQ account should have access</small>
							</br><small>Only defined users/groups should have access to app</small>
							</br><small>Only people with EQ account should have access</small>
							</br><small>Application manifest, security groups, general groups issues</small>
							</br><small>Application roles</small>
							</br><small>Issues</small>
								
							</section>

					</section>


					<section>
							<section>
								<h1>Exercise 8</h1>
								<h3>Refresh tokens</h3>
								</br><small>Re-fresh alg</small>
								</br><small>Expect more heavy lifting from framework</small>
								</br><small>Look at MSAL, roadmap ++</small>
							</section>

					</section>
					

					<section>
							<section>
								<h1>Exercise 9</h1>
								<h3>Single Page Web Application (SPA)</h3>
								<small>Implicit grant flow </small>
								<small>Sec implication, no-refresh, ....</small>
							</section>

					</section>

					<section>
							<section>
								<h1>Exercise 10</h1>
								<h3>Protecting web api's</h3>
								<small>MSAL</small>
								</br><small>AD App, Token validation</small>
								</br><small>Azure API GW - Apim</small>
							</section>

					</section>


					<section>
							<section>
								<h1>Security</h1>

							</section>

					</section>


					<section>
							<section>
								<h1>Exercise 11</h1></h2>
								<h3>Deployment - DevOps - Radix</h1>
								<small>Let's put a project into Radix</small>
							</br><small>Create a new project based on ex-10??</small>
							</section>

					</section>

					<section>
							<section>
								<h1>Hack your own project</h1>
							</section>

					</section>



			</div>

		</div>

		<script src="js/reveal.js"></script>

		<script>

			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				center: true,
				hash: true,
				slideNumber: true,
				hash: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true },
					{ src: 'plugin/search/search.js', async: true },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
